# Data Model: Better Auth Integration

**Feature Branch**: `004-better-auth-integration`
**Date**: 2026-02-06

## Entity Relationship Overview

```text
┌───────────────────────┐
│  user (Better Auth)   │
│───────────────────────│
│  id: string (PK)      │
│  name: string         │
│  email: string (UQ)   │
│  emailVerified: bool  │
│  image: string?       │
│  createdAt: timestamp │
│  updatedAt: timestamp │
└───────┬───────────────┘
        │ 1:N
        ├──────────────────────────┐
        │                          │
┌───────▼───────────────┐  ┌──────▼────────────────┐
│  session (Better Auth)│  │  account (Better Auth)│
│───────────────────────│  │───────────────────────│
│  id: string (PK)      │  │  id: string (PK)      │
│  userId: string (FK)  │  │  userId: string (FK)  │
│  token: string (UQ)   │  │  accountId: string    │
│  expiresAt: timestamp │  │  providerId: string   │
│  ipAddress: string?   │  │  accessToken: string? │
│  userAgent: string?   │  │  refreshToken: string?│
│  createdAt: timestamp │  │  expiresAt: timestamp?│
│  updatedAt: timestamp │  │  password: string?    │
└───────────────────────┘  │  createdAt: timestamp │
                           │  updatedAt: timestamp │
        │                  └───────────────────────┘
        │ 1:N
┌───────▼───────────────┐
│  verification         │
│  (Better Auth)        │
│───────────────────────│
│  id: string (PK)      │
│  identifier: string   │
│  value: string        │
│  expiresAt: timestamp │
│  createdAt: timestamp │
│  updatedAt: timestamp │
└───────────────────────┘

        │ 1:N (user → task)
┌───────▼───────────────┐
│  task (SQLModel)      │
│───────────────────────│
│  id: UUID (PK)        │
│  user_id: string (FK) │ ← Changed from UUID to string
│  title: string        │
│  description: string? │
│  is_complete: bool    │
│  created_at: timestamp│
│  updated_at: timestamp│
└───────────────────────┘
```

## Tables Managed by Better Auth

These tables are auto-generated by `npx @better-auth/cli generate`
and managed entirely by Better Auth. SQLModel does NOT touch them.

### user

| Column | Type | Constraints |
|--------|------|-------------|
| id | string | Primary key |
| name | string | Not null |
| email | string | Unique, not null |
| emailVerified | boolean | Default false |
| image | string | Nullable |
| createdAt | timestamp | Auto-generated |
| updatedAt | timestamp | Auto-updated |

### session

| Column | Type | Constraints |
|--------|------|-------------|
| id | string | Primary key |
| userId | string | FK → user.id |
| token | string | Unique |
| expiresAt | timestamp | Not null |
| ipAddress | string | Nullable |
| userAgent | string | Nullable |
| createdAt | timestamp | Auto-generated |
| updatedAt | timestamp | Auto-updated |

### account

| Column | Type | Constraints |
|--------|------|-------------|
| id | string | Primary key |
| userId | string | FK → user.id |
| accountId | string | Not null |
| providerId | string | Not null |
| accessToken | string | Nullable |
| refreshToken | string | Nullable |
| expiresAt | timestamp | Nullable |
| password | string | Nullable (hashed) |
| createdAt | timestamp | Auto-generated |
| updatedAt | timestamp | Auto-updated |

### verification

| Column | Type | Constraints |
|--------|------|-------------|
| id | string | Primary key |
| identifier | string | Not null |
| value | string | Not null |
| expiresAt | timestamp | Not null |
| createdAt | timestamp | Auto-generated |
| updatedAt | timestamp | Nullable |

## Table Managed by SQLModel (Modified)

### task

| Column | Type | Constraints | Change |
|--------|------|-------------|--------|
| id | UUID | Primary key | No change |
| user_id | **string** | FK → user.id, indexed | **Changed from UUID** |
| title | string | Not null | No change |
| description | string | Nullable | No change |
| is_complete | boolean | Default false | No change |
| created_at | timestamp | Auto-generated | No change |
| updated_at | timestamp | Auto-updated | No change |

## Migration Notes

1. The `user` table previously managed by SQLModel will be
   replaced by Better Auth's `user` table.
2. The `task.user_id` column type changes from UUID to string
   to match Better Auth's user ID format.
3. Existing data in the `user` and `task` tables will need to
   be migrated or cleared (fresh database for Better Auth setup).
4. The SQLModel `User`, `UserCreate`, `UserPublic` models are
   removed — Better Auth owns user management entirely.
5. The `Task` model's `user_id` field changes from
   `Field(foreign_key="user.id")` with UUID type to string type.
   The foreign key reference remains valid.
